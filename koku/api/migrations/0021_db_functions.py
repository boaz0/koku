# Generated by Django 2.2.13 on 2020-06-17 22:54
import os

from django.db import migrations


def apply_create_partition_procedure(apps, schema_editor):
    path = os.path.dirname(os.path.abspath(__file__))
    while True:
        if "db_functions" not in os.listdir(path):
            if path == os.path.sep:
                raise FileNotFoundError("Could not find the db_functions dir")
            path = os.path.dirname(path)
        else:
            path = os.path.join(path, "db_functions")
            break

    for funcfile in ("create_table_date_range_partition.sql", "create_date_partitions.sql"):
        sqlbuff = open(os.path.join(path, funcfile), "rt").read()
        schema_editor.execute(sqlbuff)


class Migration(migrations.Migration):

    dependencies = [("api", "0020_sources_out_of_order_delete")]

    operations = [migrations.RunPython(code=apply_create_partition_procedure)]
