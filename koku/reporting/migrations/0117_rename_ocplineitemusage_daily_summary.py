# Generated by Django 2.2.13 on 2020-06-17 22:54
from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [("reporting", "0116_partitioned_ocplineitemusage_daily_summary")]

    operations = [
        migrations.RunSQL(
            """
-- ============================================
--    Lock and rename objects
-- ============================================

LOCK TABLE reporting_ocpusagelineitem_daily_summary;

-- rename old objects
/*01*/ALTER materialized VIEW reporting_ocp_cost_summary RENAME TO __reporting_ocp_cost_summary ;
/*02*/ALTER INDEX ocp_cost_summary RENAME TO __ocp_cost_summary ;

/*03*/ALTER materialized VIEW reporting_ocp_cost_summary_by_node RENAME TO __reporting_ocp_cost_summary_by_node ;
/*04*/ALTER INDEX ocp_cost_summary_by_node RENAME TO __ocp_cost_summary_by_node ;

/*05*/ALTER materialized VIEW reporting_ocp_cost_summary_by_project RENAME TO __reporting_ocp_cost_summary_by_project ;
/*06*/ALTER INDEX ocp_cost_summary_by_project RENAME TO __ocp_cost_summary_by_project ;

/*07*/ALTER materialized VIEW reporting_ocp_pod_summary RENAME TO __reporting_ocp_pod_summary ;
/*08*/ALTER INDEX ocp_pod_summary RENAME TO __ocp_pod_summary ;

/*08*/ALTER materialized VIEW reporting_ocp_pod_summary_by_project RENAME TO __reporting_ocp_pod_summary_by_project ;
/*09*/ALTER INDEX ocp_pod_summary_by_project RENAME TO __ocp_pod_summary_by_project ;

/*10*/ALTER materialized VIEW reporting_ocp_volume_summary RENAME TO __reporting_ocp_volume_summary ;
/*11*/ALTER INDEX ocp_volume_summary RENAME TO __ocp_volume_summary ;

/*12*/ALTER materialized VIEW reporting_ocp_volume_summary_by_project RENAME TO __reporting_ocp_volume_summary_by_project ;
/*13*/ALTER INDEX ocp_volume_summary_by_project RENAME TO __ocp_volume_summary_by_project ;

/*14*/ALTER TABLE reporting_ocpusagelineitem_daily_summary
RENAME CONSTRAINT reporting_ocpusagelineitem_daily_summary_pkey TO __reporting_ocpusagelineitem_daily_summary_pkey ;
/*15*/ALTER TABLE reporting_ocpusagelineitem_daily_summary
RENAME CONSTRAINT reporting_ocpusageli_report_period_id_fc68baea_fk_reporting TO __reporting_ocpusageli_report_period_id_fc68baea_fk_reporting ;

ALTER INDEX pod_labels_idx RENAME TO __pod_labels_idx ;
ALTER INDEX summary_data_source_idx RENAME TO __summary_data_source_idx ;
ALTER INDEX reporting_ocpusagelineitem_report_period_id_fc68baea RENAME TO __reporting_ocpusagelineitem_report_period_id_fc68baea ;
ALTER INDEX summary_ocp_usage_idx RENAME TO __summary_ocp_usage_idx ;
ALTER INDEX summary_namespace_idx RENAME TO __summary_namespace_idx ;
ALTER INDEX summary_node_idx RENAME TO __summary_node_idx ;
ALTER INDEX ocp_summary_namespace_like_idx RENAME TO __ocp_summary_namespace_like_idx ;
ALTER INDEX ocp_summary_node_like_idx RENAME TO __ocp_summary_node_like_idx ;
ALTER TABLE reporting_ocpusagelineitem_daily_summary RENAME TO __reporting_ocpusagelineitem_daily_summary;
ALTER TABLE p_reporting_ocpusagelineitem_daily_summary RENAME TO reporting_ocpusagelineitem_daily_summary;

-- Rename the tables so that the new partitioned table is named the original table's name
ALTER TABLE reporting_ocpusagelineitem_daily_summary RENAME
CONSTRAINT p_reporting_ocpusagelineitem_daily_summary_pkey TO reporting_ocpusagelineitem_daily_summary_pkey ;

ALTER TABLE reporting_ocpusagelineitem_daily_summary RENAME
CONSTRAINT p_reporting_ocpusageli_report_period_id_fc68baea_fk_reporting TO reporting_ocpusageli_report_period_id_fc68baea_fk_reporting ;

-- Now rename the objects connected to the partitioned table
ALTER INDEX p_pod_labels_idx RENAME TO pod_labels_idx ;
ALTER INDEX p_summary_data_source_idx RENAME TO summary_data_source_idx ;
ALTER INDEX p_reporting_ocpusagelineitem_report_period_id_fc68baea RENAME TO reporting_ocpusagelineitem_report_period_id_fc68baea ;
ALTER INDEX p_summary_ocp_usage_idx RENAME TO summary_ocp_usage_idx ;
ALTER INDEX p_summary_namespace_idx RENAME TO summary_namespace_idx ;
ALTER INDEX p_summary_node_idx RENAME TO summary_node_idx ;
ALTER INDEX p_ocp_summary_namespace_like_idx RENAME TO ocp_summary_namespace_like_idx ;
ALTER INDEX p_ocp_summary_node_like_idx RENAME TO ocp_summary_node_like_idx ;
            """
        )
    ]
